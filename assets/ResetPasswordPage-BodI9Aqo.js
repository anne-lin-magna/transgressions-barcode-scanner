import{j as e}from"./pdf-DYy-oaAL.js";import{e as z,E as W,h as Z,ax as _,$ as x,U as v,O as J,aO as as,an as ts,aP as os,aI as ns,K as $,aq as is,aQ as cs,aR as ds,V as K,aK as I,aM as V,aF as ls,D as us,aN as ws}from"./index-FpxVjXi4.js";import{r as n}from"./react-D0H64z6d.js";import{A as ms}from"./AuthLayout-h-QJi1nB.js";/* empty css               */import"./flags-CptIphfh.js";import"./TmMenuItem-DD9-1R59.js";import"./logo-BgyMkrLu.js";const Ps=z(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),fs=z(e.jsx("circle",{cx:"12",cy:"12",r:"8"}),"FiberManualRecord"),xs=z(e.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l4 4 4-4H6c0-3.86 3.14-7 7-7s7 3.14 7 7-3.14 7-7 7c-1.9 0-3.62-.76-4.88-1.99L6.7 18.42C8.32 20.01 10.55 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m2 8v-1c0-1.1-.9-2-2-2s-2 .9-2 2v1c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1m-1 0h-2v-1c0-.55.45-1 1-1s1 .45 1 1z"}),"LockReset"),X=(s,l)=>{const P=[{translationKey:"1uppercase",regex:/[A-Z]/},{translationKey:"1lowercase",regex:/[a-z]/},{translationKey:"1specialCharacter",regex:/[!@#$%^&*()_+\-=[\]{};':'\\|,.<>/?]/},{translationKey:"1numericalCharacter",regex:/\d/},{translationKey:"minimum8Characters",regex:/.{8,}/},{translationKey:"notSameAsCurrentPassword",regex:new RegExp(`^(?!${l==null?void 0:l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}$)`)}];return s&&s.length>0&&P.push({translationKey:"notSameAsUsername",regex:new RegExp(`^(?!${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}$)`)}),P};function Q({password:s,username:l="",currentPassword:P}){const{t:i}=W(),u=Z(),f=_(u.breakpoints.down("sm")),R=n.useMemo(()=>X(l,P).map(o=>o.translationKey==="notSameAsUsername"||o.translationKey==="notSameAsCurrentPassword"?{met:s.length>0&&o.regex.test(s),label:i(o.translationKey)}:{met:o.regex.test(s),label:i(o.translationKey)}),[l,P,s,i]);return e.jsx(x,{sx:{display:"flex",flexDirection:"column",alignItems:f?"flex-start":"center",px:f?0:2},children:e.jsxs(x,{children:[e.jsxs(v,{variant:"body1",sx:{mb:2,fontWeight:500,alignSelf:f?"flex-start":"center"},testid:"passwordRequirementsTitle",children:[i("passwordMustContainAtLeast"),":"]}),e.jsx(J,{spacing:1,alignItems:"flex-start",children:R.map((m,o)=>{let g;return m.met?g=e.jsx(as,{sx:{fontSize:20,color:"success.main"}}):s.length===0?g=e.jsx(fs,{sx:{fontSize:8,color:"text.secondary"}}):g=e.jsx(Ps,{sx:{fontSize:20,color:"error.main"}}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[g,e.jsx(v,{variant:"body1",sx:{color:s.length===0?"text.secondary":m.met?"success.main":"text.secondary",fontSize:"1rem"},testid:`passwordRequirement${o}`,children:m.label})]},o+m.label)})})]})})}function As(){var H,G;const{t:s}=W(),l=ts(),P=Z(),i=_(P.breakpoints.down("sm")),[u,f]=n.useState(null),[R,m]=n.useState(null),[o,g]=n.useState(null),[C,M]=n.useState(!1),[Y,D]=n.useState(!1),U=(H=l.state)==null?void 0:H.userAccountId,[q,{isLoading:S,isSuccess:j,error:L}]=os(),{control:T,handleSubmit:F,watch:ss,setError:w,clearErrors:h,formState:{errors:p}}=ns({defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),a=ss(),y=n.useMemo(()=>$.getUserName()||"",[]),A=n.useMemo(()=>X(y).map(t=>({label:s(t.translationKey),regex:t.regex})),[y,s]),k=((G=l.state)==null?void 0:G.fromLogin)===!0;n.useEffect(()=>{if(!j&&k){const r=c=>(c.preventDefault(),!0),t=()=>{j||$.doLogout(!0)};return window.addEventListener("beforeunload",r),window.addEventListener("unload",t),()=>{window.removeEventListener("beforeunload",r),window.removeEventListener("unload",t)}}},[j,k]),n.useEffect(()=>{u&&o&&(a.currentPassword!==o.currentPassword||a.newPassword!==o.newPassword||a.confirmPassword!==o.confirmPassword)&&(f(null),h())},[a,u,o,h]),n.useEffect(()=>{if(a.newPassword){h("newPassword");for(const r of A)if(!r.regex.test(a.newPassword)){const t=r.label===s("minimum8Characters"),c=r.label===s("notSameAsUsername"),b=r.label===s("notSameAsCurrentPassword");let d=r.label;!t&&!c&&!b&&(d=`${s("passwordMustContainAtLeast")}: ${r.label}`),w("newPassword",{type:"manual",message:d});return}if(a.currentPassword&&a.newPassword===a.currentPassword){w("newPassword",{type:"manual",message:s("newPasswordSameAsOld")});return}}},[a.newPassword,a.currentPassword,w,h,s,A]),n.useEffect(()=>{a.confirmPassword&&a.newPassword&&(a.newPassword!==a.confirmPassword?w("confirmPassword",{type:"manual",message:s("passwordsDoNotMatch")}):h("confirmPassword"))},[a.newPassword,a.confirmPassword,w,h,s]);const B=n.useCallback(r=>{if(r.newPassword!==r.confirmPassword)return w("confirmPassword",{type:"manual",message:s("passwordsDoNotMatch")}),!1;if(r.currentPassword===r.newPassword)return w("newPassword",{type:"manual",message:s("newPasswordSameAsOld")}),!1;for(const t of A)if(!t.regex.test(r.newPassword)){const c=t.label===s("minimum8Characters"),b=t.label===s("notSameAsUsername"),d=t.label===s("notSameAsCurrentPassword");let E=t.label;return!c&&!b&&!d&&(E=`${s("passwordMustContainAtLeast")}: ${t.label}`),w("newPassword",{type:"manual",message:E}),!1}return!0},[w,s,A]);n.useEffect(()=>{S&&M(!0)},[S]),n.useEffect(()=>{j&&C&&(m(s("passwordResetSuccess")),D(!0),M(!1),setTimeout(()=>{$.doLogout(!0)},500))},[j,C,s]),n.useEffect(()=>{var r,t,c,b;if(L&&C){const d=L,E=((c=(t=(r=d==null?void 0:d.data)==null?void 0:r.errors)==null?void 0:t[0])==null?void 0:c.message)||((b=d==null?void 0:d.data)==null?void 0:b.message)||s("passwordResetFailed");f(E),M(!1)}},[L,C,s]);const es=n.useCallback(r=>{!B(r)||!U||(g(r),f(null),m(null),q({userAccountPasswordChangeRequest:{userAccountId:U,oldPassword:r.currentPassword,newPassword:r.newPassword}}))},[B,q]),N=r=>{es(r)},rs=n.useCallback(()=>{D(!1)},[]),O=n.useMemo(()=>!a.currentPassword||!a.newPassword||!a.confirmPassword||p.currentPassword||p.newPassword||p.confirmPassword||S?!0:u&&o?a.currentPassword===o.currentPassword&&a.newPassword===o.newPassword&&a.confirmPassword===o.confirmPassword:!1,[S,u,o,a.currentPassword,a.newPassword,a.confirmPassword,p.currentPassword,p.newPassword,p.confirmPassword]);return is("ENTER",()=>{F(N)()},{preventDefault:!0,enableOnFormTags:!0,enabled:!O}),k?e.jsxs(e.Fragment,{children:[e.jsx(ds,{testid:"resetPasswordSuccess",snackbarType:"success",message:R||s("passwordResetSuccess"),isOpen:Y,onClose:rs}),e.jsx(ms,{wide:!0,children:e.jsx(x,{component:"form",onSubmit:F(N),sx:{px:i?4:6,pb:i?5:6,mt:10},children:e.jsxs(K,{container:!0,spacing:3,children:[e.jsx(K,{size:{xs:i?12:6,md:i?12:6},children:e.jsxs(J,{children:[e.jsx(I,{name:"currentPassword",control:T,rules:{required:s("currentPasswordRequired")},render:({field:r})=>e.jsx(V,{testid:"resetPasswordCurrentPassword",label:s("currentPassword"),password:r.value,setPasswordValue:r.onChange,passwordError:!!u,setPasswordError:()=>{},helperText:" ",autoFocus:!0})}),e.jsx(I,{name:"newPassword",control:T,rules:{required:s("newPasswordRequired")},render:({field:r,fieldState:t})=>e.jsx(V,{testid:"resetPasswordNewPassword",label:s("newPassword"),password:r.value,setPasswordValue:r.onChange,passwordError:!!t.error,setPasswordError:()=>{},helperText:" "})}),e.jsx(I,{name:"confirmPassword",control:T,rules:{required:s("confirmPasswordRequired")},render:({field:r,fieldState:t})=>{var c;return e.jsx(V,{testid:"resetPasswordConfirmPassword",label:s("confirmPassword"),password:r.value,setPasswordValue:r.onChange,passwordError:!!t.error,setPasswordError:()=>{},helperText:((c=t.error)==null?void 0:c.message)||" "})}}),i&&e.jsx(x,{sx:{mt:-3},children:e.jsx(Q,{password:a.newPassword||a.confirmPassword||"",username:y})}),e.jsx(x,{sx:{minHeight:"24px"},children:e.jsx(ls,{in:!!u,timeout:500,children:e.jsx(v,{color:"error",variant:"body2",testid:"resetPasswordPageError",children:u||""})})}),e.jsx(us,{testid:"resetPasswordSubmitButton",type:"submit",fullWidth:!0,variant:"contained",size:"large",color:"primary",disabled:O,sx:{mt:5},startIcon:S?e.jsx(ws,{size:20,color:"inherit"}):e.jsx(xs,{}),children:s("resetPassword")})]})}),!i&&e.jsx(K,{size:{xs:i?12:6,md:i?12:6},children:e.jsx(Q,{password:a.newPassword||"",currentPassword:a.currentPassword||"",username:y})})]})})})]}):e.jsxs(x,{marginTop:10,textAlign:"center",children:[e.jsx(cs,{color:"error",fontSize:"large"}),e.jsx(v,{testid:"securedContentAccessDenied",variant:"h4",color:"error",textAlign:"center",children:s("accessDenied")})]})}export{As as default};
