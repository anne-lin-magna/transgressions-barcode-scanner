import{j as s}from"./pdf-DYy-oaAL.js";import{E as I,am as q,an as N,h as U,ax as D,G as F,aG as k,aH as B,aI as O,K as A,aJ as G,aq as H,$ as E,O as V,aK as L,aL as z,aM as K,U as Q,D as W,aN as _,at as $}from"./index-qaI7iPMY.js";import{r as i}from"./react-D0H64z6d.js";import{A as J}from"./AuthLayout-BZEAhwjf.js";/* empty css               */import"./flags-CptIphfh.js";import"./TmMenuItem-BqifRlCJ.js";import"./logo-BgyMkrLu.js";function ne(){const{t:u}=I(),m=q(),R=N(),C=U(),c=D(C.breakpoints.down("sm")),g=F(k),[a,f]=i.useState(null),[h,P]=i.useState(""),[o,v]=i.useState(null),[x,{isLoading:d,data:p,isSuccess:w,error:l}]=B(),{control:S,handleSubmit:T,watch:M}=O({defaultValues:{username:"",password:""}}),r=M();i.useEffect(()=>{a&&o&&(r.username!==o.username||r.password!==o.password)&&f(null)},[r.username,r.password,a,o]);const y=i.useCallback(e=>{P(e.username.toUpperCase()),v(e),x({loginRequest:{username:e.username.toUpperCase(),password:e.password,tenant:g}})},[x,g]);i.useEffect(()=>{if(w&&p){const e=A.handleLoginResponse(p,h);if(e)if(e.resetCredentials)m("/resetPassword",{replace:!0,state:{fromLogin:!0,userAccountId:e.userAccountId}});else{const n=c&&A.hasRole("RTQSTRANSGRESSION_MAINTAIN")?`/${G.mobileTransgression}`:null,t=sessionStorage.getItem("redirectAfterLogin");m(n||t||"/",{replace:!0})}}},[w,p,m,h,R,c]),i.useEffect(()=>{var e,n;if(l){const t=l==null?void 0:l.data;(n=(e=t==null?void 0:t.errors)==null?void 0:e[0])!=null&&n.message&&f(t.errors[0].message)}},[l,u]);const b=e=>{y(e)},j=i.useMemo(()=>!r.username||!r.password||d?!0:a&&o?r.username===o.username&&r.password===o.password:!1,[r.username,r.password,d,a,o]);return H("ENTER",()=>{T(b)()},{preventDefault:!0,enableOnFormTags:!0,enabled:!j}),s.jsx(J,{children:s.jsx(E,{component:"form",onSubmit:T(b),sx:{px:c?4:6,pb:c?5:6,mt:10},children:s.jsxs(V,{gap:5,children:[s.jsx(L,{name:"username",control:S,rules:{required:u("usernameRequired")},render:({field:e})=>s.jsx(z,{...e,onChange:n=>{const t=n.target.selectionStart;e.onChange(n.target.value.toUpperCase()),requestAnimationFrame(()=>{n.target.setSelectionRange(t,t)})},testid:"loginPageUsername",margin:"normal",required:!0,fullWidth:!0,label:u("username"),autoComplete:"off",autoFocus:!0,error:!!a})}),s.jsx(L,{name:"password",control:S,rules:{required:u("passwordRequired")},render:({field:e})=>s.jsx(K,{testid:"loginPagePassword",label:u("password"),password:e.value,setPasswordValue:e.onChange,passwordError:!!a,setPasswordError:()=>{},helperText:""})}),s.jsx(E,{sx:{minHeight:"24px"},children:a&&s.jsx(Q,{color:"error",variant:"body2",testid:"loginPageError",children:a})}),s.jsx(W,{testid:"loginPageLoginButton",type:"submit",fullWidth:!0,variant:"contained",size:"large",color:"primary",disabled:j,startIcon:d?s.jsx(_,{size:20,color:"inherit"}):s.jsx($,{}),children:u("login")})]})})})}export{ne as default};
